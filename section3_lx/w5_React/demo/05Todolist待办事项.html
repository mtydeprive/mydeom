<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05Todolist待办事项</title>
    <link rel="stylesheet" href="./bootstrap/dist/css/bootstrap.css">
    <script src="../node_modules/react/umd/react.development.js"></script>
    <script src="../node_modules/react-dom/umd/react-dom.development.js"></script>
    <script src="./js/browser.js"></script>
</head>

<body>
    <div class="container">
        <h1>05Todolist待办事项</h1>
        <div id="app">

        </div>
    </div>
    <script type="text/babel">
        /**
         * 05Todolist待办事项
         * 定义组件
            * Todolist
            * TodoFrom
            * TodoContent
            * TodoItem
            * TodoFoot
         */
        

        function TodoFoot({ datalist }) {
            const donelist = datalist.filter(item => item.done)
            const undonelist = datalist.filter(item => !item.done)
            return (
                <div className="p-3">
                    总数：{datalist.length}，完成：{donelist.length}，未完成：{undonelist.length}
                </div>
            )
        }
        function TodoItem({ item, index ,completeItem}) {

            return (
                <tr>
                    <th scope="row">{index + 1}</th>
                    <td>{item.todo}</td>
                    <td>{item.done ? <button className="btn btn-outline-secondary" disabled>是</button> : <button className="btn btn-outline-secondary" disabled >否</button>}</td>
                    <td>{item.addtime}</td>
                    <td>
                        <button type="button" className="btn btn-primary" onClick={completeItem.bind(null,item.id)}>{item.done?'完成':'取消'}</button>
                        <button type="button" className="btn btn-danger">删除</button>
                    </td>
                </tr>
            )
        }
        function TodoContent({ datalist,completeItem}) {
            return (
                <div className="TodoContent">
                    <table className="table table-striped ">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">待办事项</th>
                                <th scope="col">是否完成</th>
                                <th scope="col">时间</th>
                                <th scope="col">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {
                                datalist.map((item, idx) => {
                                    return <TodoItem key={item.id} item={item} index={idx}  completeItem={completeItem}/>
                                })
                            }

                        </tbody>
                    </table>
                </div>
            )
        }
        class TodoFrom extends React.Component {
            constructor(props){
                super(props)
                this.state={
                    todo:''
                }
                this.addItem=this.addItem.bind(this)
                this.changeTodo=this.changeTodo.bind(this)
            }
            addItem() {
                // 非受控组件：节点操作方式
                // const todo=this.input.value // this.refObj.current.value
                // 组件受控：组件状态操作方式
                const todo=this.state.todo
                console.log('todo',todo);
                this.props.addItem(todo)
                //清空并自动获得焦点
                this.setState({
                    todo:''
                })
                this.input.focus()
            }
            changeTodo(e){
                this.setState({
                    todo:e.target.value
                })
            }
            render() {
                //创建ref对象
                // this.refObj=React.createRef()
                // console.log(refObj.current);
                return (
                    <div className="input-group mb-3">
                        <input type="text" className="form-control" 
                        ref={(el)=>this.input=el}
                        // ref={this.refObj}
                        value={this.state.todo}
                        onChange={this.changeTodo}
                        />
                        <button className="btn btn-success" onClick={this.addItem}>添加</button>
                    </div>
                )
            }
        }
        class TodoList extends React.Component {
            constructor() {
                super()
                //定义组件状态（数据）
                this.state = {
                    // count:1,
                    datalist: [
                        {
                            id: 1,
                            todo: '定个小目标，赚它一个亿',
                            done: true,
                            addtime: Date.now() + 100
                        },
                        {
                            id: 2,
                            todo: '一天睡两年',
                            done: false,
                            addtime: Date.now() + 100
                        },
                        {
                            id: 3,
                            todo: '达成秒睡',
                            done: false,
                            addtime: Date.now() + 100
                        },
                    ]
                }
                this.addItem=this.addItem.bind(this)
                this.completeItem=this.completeItem.bind(this)
            }
            //在这里定义的方法会成为原型方法
            addItem(todo) {
                const newItem = {
                    id: parseInt(Math.random() * 10000),
                    todo,
                    done:false,
                    addtime:Date.now()
                }
                //react 中不能直接修改原来的状态，而是使用一个新的值去覆盖
                const datalist=[...this.state.datalist]
                datalist.unshift(newItem)
                this.setState({
                    datalist
                })
            }
            //定义时使用箭头函数
            completeItem(id){
                const {datalist}=this.state
                const newDatalist=datalist.map(item=>{
                    if(item.id===id){
                        item.done=!item.done
                    }
                    return {...item}
                })
                this.setState({
                    datalist:newDatalist  
                })
            }
            removeItem(){

            }
            selectItem(){

            }
            render() {
                //在类组件中
                console.log('todolist.render', this);
                const { datalist } = this.state
                return (
                    <div className="TodoList">
                        {
                            // Todolist: <button onClick={()=>{
                            //     this.setState({
                            //         count:this.state.count+1
                            //     })
                            // }}>count:{this.state.count}</button> 
                        }
                        <TodoFrom addItem={this.addItem} />
                        <TodoContent datalist={datalist} completeItem={this.completeItem}/>
                        <TodoFoot datalist={datalist} />
                    </div>
                )
            }

        }
        ReactDOM.render(
            <TodoList />
            ,
            document.querySelector('#app')
        )
    </script>
</body>

</html>